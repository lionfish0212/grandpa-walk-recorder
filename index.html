<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é˜¿å…¬æ•£æ­¥æé†’ï¼‹èªéŸ³æ—¥è¨˜</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
  h1, h2 { color: #2c3e50; }
  button { font-size: 16px; padding: 10px 20px; margin: 10px 5px 10px 0; }
  #timer { font-size: 48px; margin: 20px 0; }
  #status, #recordStatus { font-size: 18px; margin-top: 10px; }
  select { font-size: 16px; padding: 5px; }
  .record-item { margin-top: 10px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
  .record-title { font-weight: bold; }
  .record-time { font-size: 12px; color: gray; }
  audio { width: 100%; margin-top: 5px; }
  label, input { display: block; margin: 8px 0 4px; font-size: 16px; }
  input { padding: 8px; width: 300px; max-width: 90vw; }
  .delete-btn {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    margin-top: 6px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h1>é˜¿å…¬æ•£æ­¥æé†’ + æ„Ÿè¦ºè¨˜éŒ„</h1>
<p>é£¯å¾Œ10åˆ†é˜é–‹å§‹æ•£æ­¥ï¼ŒæŒ‰ä¸‹ã€Œé–‹å§‹æ•£æ­¥ã€å¾Œè‡ªå‹•è¨ˆæ™‚ã€‚</p>
<button id="startBtn">é–‹å§‹æ•£æ­¥</button>
<div id="timer">10:00</div>
<div id="status"></div>

<label for="feelSelect">ä»Šå¤©æ•£æ­¥æ„Ÿè¦ºï¼š</label>
<select id="feelSelect">
  <option value="">--é¸æ“‡ç‹€æ…‹--</option>
  <option value="è¼•é¬†">è¼•é¬†</option>
  <option value="ç–²ç´¯">ç–²ç´¯</option>
  <option value="æ²’æ•£æ­¥">æ²’æ•£æ­¥</option>
</select>
<button id="saveFeelBtn">ä¿å­˜ç‹€æ…‹</button>
<div id="savedFeel"></div>

<hr />

<h2>å®¶åº­èªéŸ³ç•™è¨€æ¿</h2>

<label for="nameInput">ç•™è¨€è€…å§“åï¼š</label>
<input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥å§“å" />

<label for="titleInput">ç•™è¨€ä¸»é¡Œï¼š</label>
<input type="text" id="titleInput" placeholder="è«‹è¼¸å…¥ç•™è¨€ä¸»é¡Œ" />

<button id="startRecBtn">é–‹å§‹éŒ„éŸ³ ğŸ™ï¸</button>
<button id="stopRecBtn" disabled>åœæ­¢éŒ„éŸ³ â¹ï¸</button>
<div id="recordStatus"></div>

<h2>ç•™è¨€æ¸…å–®</h2>
<div id="recordList"></div>
  
<script>
  // æ•£æ­¥è¨ˆæ™‚å™¨åŠŸèƒ½
  const startBtn = document.getElementById('startBtn');
  const timerDisplay = document.getElementById('timer');
  const status = document.getElementById('status');
  let timer = 600;
  let intervalId;

  function updateTimer() {
    const min = Math.floor(timer / 60).toString().padStart(2, '0');
    const sec = (timer % 60).toString().padStart(2, '0');
    timerDisplay.textContent = `${min}:${sec}`;
    if (timer <= 0) {
      clearInterval(intervalId);
      status.textContent = 'æ­å–œå®Œæˆæ•£æ­¥ï¼ğŸ’ª';
      notify('æ•£æ­¥æ™‚é–“åˆ°å›‰ï¼');
      startBtn.disabled = false;
    }
    timer--;
  }

  function notify(msg) {
    if (Notification.permission === 'granted') {
      new Notification(msg);
    }
  }

  startBtn.addEventListener('click', () => {
 if ('Notification' in window) {
    Notification.requestPermission().then(() => {
      // ä¸ç®¡æœ‰æ²’æœ‰å…è¨±ï¼Œéƒ½ç›´æ¥é–‹å§‹å€’æ•¸
      startCountdown();
    });
  } else {
    // Safari ä¸æ”¯æ´ Notificationï¼Œç…§æ¨£å€’æ•¸
    startCountdown();
  }
});
  function startCountdown() {
    timer = 600;
    startBtn.disabled = true;
    status.textContent = 'æ•£æ­¥ä¸­...åŠ æ²¹ï¼';
    updateTimer();
    intervalId = setInterval(updateTimer, 1000);
  }

  // æ•£æ­¥æ„Ÿè¦ºè¨˜éŒ„
  const feelSelect = document.getElementById('feelSelect');
  const saveFeelBtn = document.getElementById('saveFeelBtn');
  const savedFeel = document.getElementById('savedFeel');

  function getTodayKey() {
    return new Date().toISOString().slice(0, 10);
  }

  function loadFeel() {
    const key = getTodayKey();
    const val = localStorage.getItem('feel_' + key);
    if (val) {
      savedFeel.textContent = `ä»Šå¤©çš„æ•£æ­¥ç‹€æ…‹ï¼š${val}`;
      feelSelect.value = val;
    } else {
      savedFeel.textContent = 'ä»Šå¤©é‚„æ²’è¨˜éŒ„æ•£æ­¥ç‹€æ…‹';
    }
  }

  saveFeelBtn.addEventListener('click', () => {
    const val = feelSelect.value;
    if (!val) {
      alert('è«‹é¸æ“‡æ•£æ­¥æ„Ÿè¦º');
      return;
    }
    localStorage.setItem('feel_' + getTodayKey(), val);
    savedFeel.textContent = `å·²å„²å­˜ä»Šå¤©çš„ç‹€æ…‹ï¼š${val}`;
  });

  loadFeel();

  // éŒ„éŸ³ç•™è¨€åŠŸèƒ½
  const startRecBtn = document.getElementById('startRecBtn');
  const stopRecBtn = document.getElementById('stopRecBtn');
  const recordStatus = document.getElementById('recordStatus');
  const recordList = document.getElementById('recordList');
  const nameInput = document.getElementById('nameInput');
  const titleInput = document.getElementById('titleInput');

  let mediaRecorder;
  let audioChunks = [];

  // é¡¯ç¤ºç•™è¨€æ¸…å–®
  function loadRecords() {
    recordList.innerHTML = '';
    let records = JSON.parse(localStorage.getItem('voiceRecords') || '[]');
    records.forEach((rec, idx) => {
      const div = document.createElement('div');
      div.className = 'record-item';
      div.innerHTML = `
        <div class="record-title">${rec.title || 'æœªå‘½åç•™è¨€'}</div>
        <div class="record-time">ç•™è¨€è€…ï¼š${rec.name || 'åŒ¿å'} | æ™‚é–“ï¼š${rec.time}</div>
        <audio controls src="${rec.audioUrl}"></audio>
        <button class="delete-btn" data-index="${idx}">åˆªé™¤ç•™è¨€</button>
      `;
      recordList.appendChild(div);
    });

    // ç¶å®šåˆªé™¤åŠŸèƒ½
    recordList.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.getAttribute('data-index');
        deleteRecord(idx);
      };
    });
  }

  function deleteRecord(index) {
    let records = JSON.parse(localStorage.getItem('voiceRecords') || '[]');
    records.splice(index, 1);
    localStorage.setItem('voiceRecords', JSON.stringify(records));
    loadRecords();
  }

  startRecBtn.onclick = async () => {
    if (!nameInput.value.trim()) {
      alert('è«‹å…ˆè¼¸å…¥ç•™è¨€è€…å§“å');
      return;
    }
    if (!titleInput.value.trim()) {
      alert('è«‹å…ˆè¼¸å…¥ç•™è¨€ä¸»é¡Œ');
      return;
    }
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert('æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŒ„éŸ³åŠŸèƒ½');
      return;
    }

    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

      mediaRecorder.onstart = () => {
        recordStatus.textContent = 'éŒ„éŸ³ä¸­...';
        startRecBtn.disabled = true;
        stopRecBtn.disabled = false;
      };

      mediaRecorder.onstop = () => {
       const audioBlob = new Blob(audioChunks); // ä¸æŒ‡å®šæ ¼å¼ï¼Œè®“ç€è¦½å™¨æ±ºå®šæœ€ç›¸å®¹çš„
        const audioUrl = URL.createObjectURL(audioBlob);

        const record = {
          name: nameInput.value.trim(),
          title: titleInput.value.trim(),
          time: new Date().toLocaleString('zh-TW'),
          audioUrl: audioUrl
        };

        let records = JSON.parse(localStorage.getItem('voiceRecords') || '[]');
        records.unshift(record);
        localStorage.setItem('voiceRecords', JSON.stringify(records));

        recordStatus.textContent = 'éŒ„éŸ³å®Œæˆï¼Œå·²å„²å­˜ç•™è¨€ã€‚';
        loadRecords();

        startRecBtn.disabled = false;
        stopRecBtn.disabled = true;
      };

      mediaRecorder.start();
    } catch (e) {
      alert('éŒ„éŸ³å¤±æ•—ï¼Œè«‹ç¢ºèªéº¥å…‹é¢¨æ¬Šé™å·²å…è¨±');
      console.error(e);
    }
  };

  stopRecBtn.onclick = () => {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
      mediaRecorder.stop();
    }
  };

  // é é¢è¼‰å…¥æ™‚è®€å–ç•™è¨€
  loadRecords();
</script>
<div class="box">
  <h3>ğŸŒ ä»Šæ—¥æº«æš–å°èª</h3>
  <p id="quote">è¼‰å…¥ä¸­...</p>
</div>
<script>
  const quotes = [
    "æœ‰ä½ åœ¨ï¼Œé€™å€‹å®¶å°±å¾ˆæº«æš–ã€‚â¤ï¸",
    "è¦å¥½å¥½åƒé£¯",
    "è¨˜å¾—å–æ°´ï¼Œä¹Ÿè¦è¨˜å¾—ç…§é¡§è‡ªå·±ã€‚",
    "ä»Šå¤©ä¹Ÿè¨±å¹³å‡¡ï¼Œä½†ä½ æ˜¯é‡è¦çš„å­˜åœ¨ã€‚",
    "é¡˜ä»Šå¤©çš„ä½ ï¼Œè¼•é¬†è‡ªåœ¨ï¼Œå¿ƒæƒ…æ™´æœ—ã€‚",
    "èº«é‚Šçš„äººéƒ½æ„›ä½ ï¼Œé€£æˆ‘ä¹Ÿæ˜¯ã€‚âœ¨"
  ];

  function getTodayKey() {
    return new Date().toISOString().slice(0, 10);
  }

  function getDailyQuote() {
    const today = getTodayKey();
    const stored = localStorage.getItem("dailyQuote_" + today);
    if (stored) {
      return stored;
    } else {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      localStorage.setItem("dailyQuote_" + today, quote);
      return quote;
    }
  }

  document.getElementById("quote").textContent = getDailyQuote();
</script>

</body>
</html>
